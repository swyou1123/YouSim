{"version":3,"file":"withSentryGetServerSideProps.js","sources":["../../../../src/config/wrappers/withSentryGetServerSideProps.ts"],"sourcesContent":["import { hasTracingEnabled } from '@sentry/tracing';\nimport { serializeBaggage } from '@sentry/utils';\nimport { GetServerSideProps } from 'next';\n\nimport { isBuild } from '../../utils/isBuild';\nimport { callTracedServerSideDataFetcher, getTransactionFromRequest, withErrorInstrumentation } from './wrapperUtils';\n\n/**\n * Create a wrapped version of the user's exported `getServerSideProps` function\n *\n * @param origGetServerSideProps The user's `getServerSideProps` function\n * @param parameterizedRoute The page's parameterized route\n * @returns A wrapped version of the function\n */\nexport function withSentryGetServerSideProps(\n  origGetServerSideProps: GetServerSideProps,\n  parameterizedRoute: string,\n): GetServerSideProps {\n  return async function (\n    ...getServerSidePropsArguments: Parameters<GetServerSideProps>\n  ): ReturnType<GetServerSideProps> {\n    if (isBuild()) {\n      return origGetServerSideProps(...getServerSidePropsArguments);\n    }\n\n    const [context] = getServerSidePropsArguments;\n    const { req, res } = context;\n\n    const errorWrappedGetServerSideProps = withErrorInstrumentation(origGetServerSideProps);\n\n    if (hasTracingEnabled()) {\n      const serverSideProps = await callTracedServerSideDataFetcher(\n        errorWrappedGetServerSideProps,\n        getServerSidePropsArguments,\n        req,\n        res,\n        {\n          dataFetcherRouteName: parameterizedRoute,\n          requestedRouteName: parameterizedRoute,\n          dataFetchingMethodName: 'getServerSideProps',\n        },\n      );\n\n      if ('props' in serverSideProps) {\n        const requestTransaction = getTransactionFromRequest(req);\n        if (requestTransaction) {\n          serverSideProps.props._sentryTraceData = requestTransaction.toTraceparent();\n          serverSideProps.props._sentryBaggage = serializeBaggage(requestTransaction.getBaggage());\n        }\n      }\n\n      return serverSideProps;\n    } else {\n      return errorWrappedGetServerSideProps(...getServerSidePropsArguments);\n    }\n  };\n}\n"],"names":[],"mappings":";;;;;;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;"}