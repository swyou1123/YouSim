{"version":3,"file":"withSentryServerSideDocumentGetInitialProps.js","sources":["../../../../src/config/wrappers/withSentryServerSideDocumentGetInitialProps.ts"],"sourcesContent":["import { hasTracingEnabled } from '@sentry/tracing';\nimport Document from 'next/document';\n\nimport { isBuild } from '../../utils/isBuild';\nimport { callTracedServerSideDataFetcher, withErrorInstrumentation } from './wrapperUtils';\n\ntype DocumentGetInitialProps = typeof Document.getInitialProps;\n\n/**\n * Create a wrapped version of the user's exported `getInitialProps` function in\n * a custom document (\"_document.js\").\n *\n * @param origDocumentGetInitialProps The user's `getInitialProps` function\n * @param parameterizedRoute The page's parameterized route\n * @returns A wrapped version of the function\n */\nexport function withSentryServerSideDocumentGetInitialProps(\n  origDocumentGetInitialProps: DocumentGetInitialProps,\n): DocumentGetInitialProps {\n  return async function (\n    ...documentGetInitialPropsArguments: Parameters<DocumentGetInitialProps>\n  ): ReturnType<DocumentGetInitialProps> {\n    if (isBuild()) {\n      return origDocumentGetInitialProps(...documentGetInitialPropsArguments);\n    }\n\n    const [context] = documentGetInitialPropsArguments;\n    const { req, res } = context;\n\n    const errorWrappedGetInitialProps = withErrorInstrumentation(origDocumentGetInitialProps);\n\n    if (hasTracingEnabled()) {\n      // Since this wrapper is only applied to `getInitialProps` running on the server, we can assert that `req` and\n      // `res` are always defined: https://nextjs.org/docs/api-reference/data-fetching/get-initial-props#context-object\n      return callTracedServerSideDataFetcher(\n        errorWrappedGetInitialProps,\n        documentGetInitialPropsArguments,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        req!,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        res!,\n        {\n          dataFetcherRouteName: '/_document',\n          requestedRouteName: context.pathname,\n          dataFetchingMethodName: 'getInitialProps',\n        },\n      );\n    } else {\n      return errorWrappedGetInitialProps(...documentGetInitialPropsArguments);\n    }\n  };\n}\n"],"names":[],"mappings":";;;;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;"}